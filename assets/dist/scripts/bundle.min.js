"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Gallery=function(){var r,t,n,o,a,l,e,i,s,c,d,u,p,m,f,y,g,h,v,L,b,S=document.querySelector(".gallery-images");S&&(r=document.querySelector(".gallery-images-inner"),t=document.querySelector(".gallery-panel"),n=t.querySelector(".panel-image-preview .content-image"),o=t.querySelector(".panel-load-images"),a=t.querySelector(".panel-image-controls"),l=a.querySelector(".panel-image-name"),e=a.querySelector(".panel-image-delete"),i=document.querySelector("#images-input"),s=document.querySelector(".gallery-empty"),c=null,S.addEventListener("mousedown",function(e){var e=e.target.closest(".content-item");e&&(e=e,n.src=e.dataset.url,c&&c.classList.remove("is-current"),(c=e).classList.add("is-current"),a.classList.remove("is-hidden"),e=e.dataset.url.split("/"),l.innerHTML=e[e.length-1])}),u=d=0,p=t.querySelector(".load-loaded"),m=t.querySelector(".load-total"),f=function(){d++,p.innerHTML=d,u<=d&&(o.classList.add("panel-load-images-loaded"),o.classList.remove("panel-load-images-loading"))},y=function(e){m.innerHTML=e.length,u=e.length,d=0,_toConsumableArray(e).forEach(function(e){return a=e,(e=new FormData).append("file",a),o.classList.remove("panel-load-images-loaded"),o.classList.add("panel-load-images-loading"),void fetch("/inc/upload.php",{method:"POST",body:e}).then(function(e){e.json().then(function(e){var t,n;e.ok?(f(),(t=document.createElement("DIV")).className="content-item",t.dataset.url=e.response,(n=document.createElement("IMG")).src=e.thumbnail,t.appendChild(n),r.prepend(t),L++,s&&s.remove()):console.log(e.error+a.name)})}).catch(function(e){});var a})},t.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation(),t.classList.add("gallery-panel-files")}),t.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation(),t.classList.add("gallery-panel-files")}),t.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation(),t.classList.remove("gallery-panel-files")}),t.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation(),t.classList.remove("gallery-panel-files");e=e.dataTransfer.files;y(e)}),i.addEventListener("change",function(){y(i.files)}),g=parseInt(S.dataset.count),h=parseInt(S.dataset.chunks),v=0,L=16,b=S.querySelector(".gallery-load-more .button"),b&&b.addEventListener("click",function(){var e,t,n;t=v+=e=h,(n=new FormData).append("limit",e),n.append("offset",t),b.classList.add("button-disabled"),fetch("/inc/fetch.php",{method:"POST",body:n}).then(function(e){e.json().then(function(e){b.classList.remove("button-disabled"),e.images&&e.images.forEach(function(e){var t=document.createElement("DIV"),n=(t.className="content-item",t.dataset.url=e.url,document.createElement("IMG"));n.src=e.thumbnail,t.appendChild(n),r.appendChild(t),g<=++L&&b.parentNode.remove()})})}).catch(function(e){console.log(e)})}),e.addEventListener("click",function(){var e=new FormData,t=c;e.append("id",t.dataset.id),fetch("/inc/delete.php",{method:"POST",body:e}).then(function(e){e.json().then(function(e){t.remove(),g--,n.src="",a.classList.add("is-hidden")})}).catch(function(e){console.log(e)})}))};window.addEventListener("load",function(){Gallery()});