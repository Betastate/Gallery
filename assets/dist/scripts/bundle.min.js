"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var a;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(a="Object"===(a=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var Gallery=function(){var n,t,a,o,r,l,e,i,s,c,d,u,p,m,y,f,g,v,h,L,b=document.querySelector(".gallery-images");b&&(n=document.querySelector(".gallery-images-inner"),t=document.querySelector(".gallery-panel"),a=t.querySelector(".panel-image-preview .content-image"),o=t.querySelector(".panel-load-images"),r=t.querySelector(".panel-image-controls"),l=r.querySelector(".panel-image-name"),r.querySelector(".panel-image-name"),e=document.querySelector("#images-input"),i=document.querySelector(".gallery-empty"),s=null,b.addEventListener("mousedown",function(e){var e=e.target.closest(".content-item");e&&(e=e,a.src=e.dataset.url,s&&s.classList.remove("is-current"),(s=e).classList.add("is-current"),r.classList.remove("is-hidden"),e=e.dataset.url.split("/"),l.innerHTML=e[e.length-1])}),d=c=0,u=t.querySelector(".load-loaded"),p=t.querySelector(".load-total"),m=function(){c++,u.innerHTML=c,d<=c&&(o.classList.add("panel-load-images-loaded"),o.classList.remove("panel-load-images-loading"))},y=function(e){p.innerHTML=e.length,d=e.length,c=0,_toConsumableArray(e).forEach(function(e){return r=e,(e=new FormData).append("file",r),o.classList.remove("panel-load-images-loaded"),o.classList.add("panel-load-images-loading"),void fetch("/inc/upload.php",{method:"POST",body:e}).then(function(e){e.json().then(function(e){var t,a;e.ok?(m(),(t=document.createElement("DIV")).className="content-item",t.dataset.url=e.response,(a=document.createElement("IMG")).src=e.thumbnail,t.appendChild(a),n.prepend(t),h++,i&&i.remove()):console.log(e.error+r.name)})}).catch(function(e){});var r})},t.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation(),t.classList.add("gallery-panel-files")}),t.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation(),t.classList.add("gallery-panel-files")}),t.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation(),t.classList.remove("gallery-panel-files")}),t.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation(),t.classList.remove("gallery-panel-files");e=e.dataTransfer.files;y(e)}),e.addEventListener("change",function(){y(e.files)}),f=parseInt(b.dataset.count),g=parseInt(b.dataset.chunks),v=0,h=16,L=b.querySelector(".gallery-load-more .button"),L&&L.addEventListener("click",function(){var e,t,a;t=v+=e=g,(a=new FormData).append("limit",e),a.append("offset",t),L.classList.add("button-disabled"),fetch("/inc/fetch.php",{method:"POST",body:a}).then(function(e){e.json().then(function(e){L.classList.remove("button-disabled"),e.images&&e.images.forEach(function(e){var t=document.createElement("DIV"),a=(t.className="content-item",t.dataset.url=e.url,document.createElement("IMG"));a.src=e.thumbnail,t.appendChild(a),n.appendChild(t),f<=++h&&L.parentNode.remove()})})}).catch(function(e){console.log(e)})}))};window.addEventListener("load",function(){Gallery()});